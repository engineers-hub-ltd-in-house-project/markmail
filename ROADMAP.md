# MarkMail 開発ロードマップ

## 🎯 プロジェクトビジョン

MarkMailは、エンジニア向けのマーケティングオートメーションツールとして、マークダウンベースのメール作成と高度な自動化機能を提供します。将来的には、フルスタックのマーケティングオートメーションプラットフォームへと進化させます。

## 📅 開発フェーズ

### Phase 0: テスト基盤の確立（2025年6月）🆕

#### 0.1 E2Eテスト基盤の構築

- **目的**: ユーザー体験を保証する自動化テストの確立
- **実装内容**:
  - Playwrightの導入と設定
  - CI/CDパイプラインへの統合
  - テストデータ管理システム
  - スクリーンショット・動画記録機能
  - 並列実行環境の構築
- **技術仕様**:
  - テストフレームワーク: Playwright
  - テストランナー: Playwright Test Runner
  - レポート: HTML/Allure Reports

#### 0.2 クリティカルユーザージャーニーのE2Eテスト

- **実装内容**:
  - ユーザー登録・ログインフロー
  - テンプレート作成・編集・削除
  - キャンペーン作成・送信
  - 購読者管理・インポート
  - フォーム作成・公開・送信
  - シーケンス設定・実行
- **成功基準**:
  - 全クリティカルパスのテスト自動化
  - 実行時間30分以内
  - 成功率95%以上

#### 0.3 テストカバレッジの改善

- **実装内容**:
  - 既存テストのギャップ分析
  - 不足している統合テストの追加
  - APIテストの網羅性向上
  - エラーハンドリングテスト
  - エッジケーステスト
- **成功基準**:
  - バックエンド統合テスト: 90%以上
  - フロントエンドユニットテスト: 70%以上
  - E2Eテストによるユーザーフロー: 100%

### Phase 1: コア機能の強化（2025年7月〜8月）

#### 1.1 フォームビルダー機能

- **目的**: 購読者獲得のためのフォーム作成・管理機能
- **実装内容**:
  - [x] マークダウンベースのフォームビルダー
  - [x] フォームフィールドの動的生成（テキスト、選択、チェックボックス等）
  - [ ] フォームテンプレート機能
  - [x] レスポンシブデザイン対応
  - [x] バリデーション設定
- **技術仕様**:
  - [x] フロントエンド: Svelteコンポーネント
  - [x] バックエンド: フォーム定義の保存API
  - [x] データベース: forms、form_fields テーブル

#### 1.2 フォーム公開・埋め込み機能

- **目的**: 作成したフォームを外部サイトに埋め込み可能に
- **実装内容**:
  - [x] 一意のフォームURL生成
  - [ ] iframeエンベッド機能
  - [ ] JavaScriptウィジェット提供
  - [x] CORS対応
  - [x] フォーム送信API（認証不要）
- **技術仕様**:
  - [x] 公開URLパターン: `/forms/{form_id}/public`
  - [ ] エンベッドスクリプト: CDN配信

#### 1.3 ダブルオプトイン機能

- **目的**: 購読者の確実な同意取得とスパム防止
- **実装内容**:
  - [ ] 確認メール自動送信
  - [ ] 確認リンク生成・管理
  - [ ] 確認状態の追跡
  - [ ] 確認期限設定（72時間）
  - [ ] 再送信機能
- **技術仕様**:
  - [ ] 確認トークン: UUID v4
  - [ ] データベース: subscription_confirmations テーブル

### Phase 2: メールシーケンス機能（2025年2月〜3月）

#### 2.1 メールシーケンス設計

- **目的**: 購読者に対する自動メール配信シーケンス
- **実装内容**:
  - [x] シーケンステンプレート作成
  - [x] トリガー設定（登録後、特定アクション後等）
  - [x] 配信間隔設定（即時、X日後、X時間後）
  - [x] 条件分岐（開封、クリック、属性ベース）
- **技術仕様**:
  - [x] データベース: sequences、sequence_steps テーブル
  - [x] ジョブキュー: バックグラウンドワーカー（Tokio）

#### 2.2 ウェルカムメール自動化

- **目的**: 新規購読者への即時ウェルカムメール送信
- **実装内容**:
  - [x] デフォルトウェルカムメールテンプレート
  - [x] カスタマイズ可能な変数
  - [x] 送信タイミング設定
  - [ ] A/Bテスト対応
- **技術仕様**:
  - [x] イベント駆動アーキテクチャ
  - [x] 購読者登録イベント → メール送信ジョブ

### Phase 3: 外部システム連携（2025年3月〜4月）

#### 3.1 Salesforce インテグレーション

- **目的**: CRMデータとの双方向同期
- **実装内容**:
  - [ ] OAuth 2.0認証
  - [ ] リード/取引先責任者の同期
  - [ ] カスタムフィールドマッピング
  - [ ] リアルタイム同期（Webhook）
  - [ ] バッチ同期（定期実行）
- **技術仕様**:
  - [ ] Salesforce REST API v59.0
  - [ ] データベース: integrations、field_mappings テーブル

#### 3.2 その他のインテグレーション

- **HubSpot連携**
  - [ ] コンタクト同期
  - [ ] マーケティングイベント連携
- **Zapier対応**
  - [ ] Webhook エンドポイント
  - [ ] アクショントリガー設定
- **REST API拡張**
  - [ ] 外部システム向けAPI
  - [ ] APIキー管理
  - [ ] レート制限

### Phase 4: 高度な機能（2025年4月〜6月）

#### 4.1 配信設計ツール

- **目的**: 複雑なメール配信フローの視覚的設計
- **実装内容**:
  - [ ] ドラッグ&ドロップフローエディタ
  - [ ] 条件分岐ノード
  - [ ] 待機ノード
  - [ ] アクショントリガーノード
- **技術仕様**:
  - [ ] フロントエンド: フローチャートライブラリ（例: React Flow）
  - [ ] バックエンド: フロー定義のJSON保存

#### 4.2 分析・レポート機能

- **実装内容**:
  - [ ] ダッシュボード
  - [ ] 開封率・クリック率の追跡
  - [ ] コンバージョン追跡
  - [ ] レポートエクスポート（PDF/CSV）

#### 4.3 A/Bテスト機能

- **実装内容**:
  - [ ] 件名テスト
  - [ ] コンテンツテスト
  - [ ] 送信時刻テスト
  - [ ] 統計的有意性の計算

## 🔧 技術的実装ガイドライン

### データベース設計原則

- 正規化を保ちつつ、パフォーマンスを考慮
- インデックスの適切な設定
- 将来の拡張性を考慮したスキーマ設計

### API設計原則

- RESTful設計の遵守
- 一貫性のあるエラーレスポンス
- ページネーションの統一実装
- バージョニング戦略

### セキュリティ考慮事項

- OWASP Top 10への対応
- 入力検証の徹底
- SQLインジェクション対策（SQLx使用）
- XSS対策（適切なエスケープ）
- CSRF対策

### パフォーマンス最適化

- Redis キャッシュの活用
- データベースクエリの最適化
- N+1問題の回避
- 非同期処理の活用

## 📝 開発者向けメモ

### 新機能追加時のチェックリスト

1. [ ] データベーススキーマの設計・マイグレーション作成
2. [ ] バックエンドAPI実装
3. [ ] APIテスト作成（単体・統合）
4. [ ] フロントエンド実装
5. [ ] フロントエンドテスト作成
6. [ ] ドキュメント更新
7. [ ] レビュー・マージ

### テスト戦略

#### 包括的テスト戦略 🎯

##### 1. E2Eテスト（Playwright）

- **目的**: 実際のユーザー体験を網羅的に検証
- **カバレッジ目標**: クリティカルユーザージャーニーの100%
- **実行タイミング**:
  - プルリクエスト時（スモークテスト）
  - デプロイ前（フルテスト）
  - 夜間定期実行（回帰テスト）

##### 2. 統合テスト

- **バックエンド**: APIエンドポイントの結合テスト（カバレッジ90%以上）
- **フロントエンド**: コンポーネント間の連携テスト
- **データベース**: マイグレーション整合性テスト

##### 3. ユニットテスト

- **バックエンド**: ビジネスロジック単体テスト（カバレッジ80%以上）
- **フロントエンド**: コンポーネント単体テスト（カバレッジ70%以上）
- **共通ユーティリティ**: 100%カバレッジ

##### 4. パフォーマンステスト

- **負荷テスト**: k6による大量同時アクセステスト
- **応答時間**: 各エンドポイント2秒以内
- **同時接続数**: 1000ユーザー同時アクセス対応

### デプロイ戦略

- 機能フラグによる段階的リリース
- Blue-Greenデプロイメント
- ロールバック計画の準備

## 🚀 今後の展望

### 長期ビジョン（2025年後半〜）

- AI機能の統合（コンテンツ生成、最適化提案）
- マルチチャネル対応（SMS、プッシュ通知）
- 高度なセグメンテーション機能
- 予測分析機能
- エンタープライズ向け機能（SAML SSO、監査ログ）

### コミュニティ・エコシステム

- プラグインシステム
- マーケットプレイス
- 開発者向けSDK
- コミュニティテンプレート共有

---

## 📌 重要な注意事項

1. **機能実装の優先順位**: Phase 1から順番に実装すること
2. **既存コードの活用**: 既に実装済みの機能を最大限活用
3. **テストファースト**: 新機能は必ずテストを先に書く
4. **ドキュメント駆動**: APIドキュメントを先に作成
5. **セキュリティファースト**: セキュリティを後回しにしない

このロードマップは定期的に見直し、市場のニーズやフィードバックに基づいて更新されます。
