# MarkMail 開発ロードマップ

## 🎯 プロジェクトビジョン

MarkMailは、エンジニア向けのマーケティングオートメーションツールとして、マークダウンベースのメール作成と高度な自動化機能を提供します。将来的には、フルスタックのマーケティングオートメーションプラットフォームへと進化させます。

## 📅 開発フェーズ

### Phase 1: コア機能の強化（2025年1月〜2月）

#### 1.1 フォームビルダー機能 🎯

- **目的**: 購読者獲得のためのフォーム作成・管理機能
- **実装内容**:
  - マークダウンベースのフォームビルダー
  - フォームフィールドの動的生成（テキスト、選択、チェックボックス等）
  - フォームテンプレート機能
  - レスポンシブデザイン対応
  - バリデーション設定
- **技術仕様**:
  - フロントエンド: Svelteコンポーネント
  - バックエンド: フォーム定義の保存API
  - データベース: forms、form_fields テーブル

#### 1.2 フォーム公開・埋め込み機能 🎯

- **目的**: 作成したフォームを外部サイトに埋め込み可能に
- **実装内容**:
  - 一意のフォームURL生成
  - iframeエンベッド機能
  - JavaScriptウィジェット提供
  - CORS対応
  - フォーム送信API（認証不要）
- **技術仕様**:
  - 公開URLパターン: `/forms/{form_id}/public`
  - エンベッドスクリプト: CDN配信

#### 1.3 ダブルオプトイン機能 🎯

- **目的**: 購読者の確実な同意取得とスパム防止
- **実装内容**:
  - 確認メール自動送信
  - 確認リンク生成・管理
  - 確認状態の追跡
  - 確認期限設定（72時間）
  - 再送信機能
- **技術仕様**:
  - 確認トークン: UUID v4
  - データベース: subscription_confirmations テーブル

### Phase 2: メールシーケンス機能（2025年2月〜3月）

#### 2.1 メールシーケンス設計 🎯

- **目的**: 購読者に対する自動メール配信シーケンス
- **実装内容**:
  - シーケンステンプレート作成
  - トリガー設定（登録後、特定アクション後等）
  - 配信間隔設定（即時、X日後、X時間後）
  - 条件分岐（開封、クリック、属性ベース）
- **技術仕様**:
  - データベース: sequences、sequence_steps テーブル
  - ジョブキュー: Redis + バックグラウンドワーカー

#### 2.2 ウェルカムメール自動化 🎯

- **目的**: 新規購読者への即時ウェルカムメール送信
- **実装内容**:
  - デフォルトウェルカムメールテンプレート
  - カスタマイズ可能な変数
  - 送信タイミング設定
  - A/Bテスト対応
- **技術仕様**:
  - イベント駆動アーキテクチャ
  - 購読者登録イベント → メール送信ジョブ

### Phase 3: 外部システム連携（2025年3月〜4月）

#### 3.1 Salesforce インテグレーション 🎯

- **目的**: CRMデータとの双方向同期
- **実装内容**:
  - OAuth 2.0認証
  - リード/取引先責任者の同期
  - カスタムフィールドマッピング
  - リアルタイム同期（Webhook）
  - バッチ同期（定期実行）
- **技術仕様**:
  - Salesforce REST API v59.0
  - データベース: integrations、field_mappings テーブル

#### 3.2 その他のインテグレーション

- **HubSpot連携**
  - コンタクト同期
  - マーケティングイベント連携
- **Zapier対応**
  - Webhook エンドポイント
  - アクショントリガー設定
- **REST API拡張**
  - 外部システム向けAPI
  - APIキー管理
  - レート制限

### Phase 4: 高度な機能（2025年4月〜6月）

#### 4.1 配信設計ツール

- **目的**: 複雑なメール配信フローの視覚的設計
- **実装内容**:
  - ドラッグ&ドロップフローエディタ
  - 条件分岐ノード
  - 待機ノード
  - アクショントリガーノード
- **技術仕様**:
  - フロントエンド: フローチャートライブラリ（例: React Flow）
  - バックエンド: フロー定義のJSON保存

#### 4.2 分析・レポート機能

- **実装内容**:
  - ダッシュボード
  - 開封率・クリック率の追跡
  - コンバージョン追跡
  - レポートエクスポート（PDF/CSV）

#### 4.3 A/Bテスト機能

- **実装内容**:
  - 件名テスト
  - コンテンツテスト
  - 送信時刻テスト
  - 統計的有意性の計算

## 🔧 技術的実装ガイドライン

### データベース設計原則

- 正規化を保ちつつ、パフォーマンスを考慮
- インデックスの適切な設定
- 将来の拡張性を考慮したスキーマ設計

### API設計原則

- RESTful設計の遵守
- 一貫性のあるエラーレスポンス
- ページネーションの統一実装
- バージョニング戦略

### セキュリティ考慮事項

- OWASP Top 10への対応
- 入力検証の徹底
- SQLインジェクション対策（SQLx使用）
- XSS対策（適切なエスケープ）
- CSRF対策

### パフォーマンス最適化

- Redis キャッシュの活用
- データベースクエリの最適化
- N+1問題の回避
- 非同期処理の活用

## 📝 開発者向けメモ

### 新機能追加時のチェックリスト

1. [ ] データベーススキーマの設計・マイグレーション作成
2. [ ] バックエンドAPI実装
3. [ ] APIテスト作成（単体・統合）
4. [ ] フロントエンド実装
5. [ ] フロントエンドテスト作成
6. [ ] ドキュメント更新
7. [ ] レビュー・マージ

### テスト戦略

- バックエンド: 単体テスト + 統合テスト（カバレッジ80%以上）
- フロントエンド: コンポーネントテスト + E2Eテスト
- 負荷テスト: 大量データでのパフォーマンステスト

### デプロイ戦略

- 機能フラグによる段階的リリース
- Blue-Greenデプロイメント
- ロールバック計画の準備

## 🚀 今後の展望

### 長期ビジョン（2025年後半〜）

- AI機能の統合（コンテンツ生成、最適化提案）
- マルチチャネル対応（SMS、プッシュ通知）
- 高度なセグメンテーション機能
- 予測分析機能
- エンタープライズ向け機能（SAML SSO、監査ログ）

### コミュニティ・エコシステム

- プラグインシステム
- マーケットプレイス
- 開発者向けSDK
- コミュニティテンプレート共有

---

## 📌 重要な注意事項

1. **機能実装の優先順位**: Phase 1から順番に実装すること
2. **既存コードの活用**: 既に実装済みの機能を最大限活用
3. **テストファースト**: 新機能は必ずテストを先に書く
4. **ドキュメント駆動**: APIドキュメントを先に作成
5. **セキュリティファースト**: セキュリティを後回しにしない

このロードマップは定期的に見直し、市場のニーズやフィードバックに基づいて更新されます。
