# MarkMail 開発規約

このドキュメントでは、MarkMailプロジェクトにおける開発規約と重要なガイドラインを説明します。すべての開発者はこのガイドラインに従ってください。

## 📋 基本開発ポリシー

1. **品質重視**: すべてのコードは高品質でテスト可能であること
2. **規約順守**: コーディング規約と自動整形ルールを厳守すること
3. **テスト駆動**: 新機能開発時はテストを先に書くことを推奨
4. **コミットメッセージ**:
   [Conventional Commits](https://www.conventionalcommits.org/)形式に従うこと
5. **テスト**: すべてのPRはテスト合格が必須条件

## ⚠️ 絶対に行ってはいけないこと

1. **テストの無効化**: テストが失敗する場合は、テスト条件を緩和せず、根本的な問題を修正してください
2. **警告の無視**: Clippy/ESLintの警告を無視したコミットは禁止です
3. **シークレットの漏洩**: .envファイルや秘密鍵をコミットしないでください
4. **大規模な自動整形**: コード変更とフォーマット変更は別コミットにしてください
5. **直接mainブランチへのプッシュ**: すべての変更はPRを通して行ってください

## 🔄 ブランチ戦略

### ブランチ命名規則

- `feature/xxxx` - 新機能開発
- `fix/xxxx` - バグ修正
- `refactor/xxxx` - リファクタリング
- `docs/xxxx` - ドキュメント関連
- `test/xxxx` - テスト関連

### マージフロー

1. 機能ブランチを作成
2. 開発とコミット
3. プルリクエストを作成
4. コードレビュー
5. CIチェック（テスト・リント）
6. マージ

## 💻 コーディング規約

### Rust

- [Rust API Guidelines](https://rust-lang.github.io/api-guidelines/)に従う
- ドキュメントコメント（`///`）を適切に記述
- 関数は小文字のスネークケース（`do_something`）
- 構造体・列挙型はキャメルケース（`MyStruct`）
- `Option<T>`と`Result<T, E>`を適切に活用
- `unwrap()`や`expect()`は極力避け、適切にエラーハンドリングを行う
- `#[derive(Debug)]`を積極的に活用

### TypeScript/JavaScript

- TypeScriptの型を常に使用
- `any`型を極力避ける
- インターフェースと型エイリアスを適切に活用
- 関数や変数はキャメルケース（`doSomething`）
- コンポーネントや型はパスカルケース（`MyComponent`）
- 非同期処理は`async/await`を使用
- コンソールログはデバッグのみに使用し、本番コードには残さない

### Svelte

- コンポーネントはシングルファイルコンポーネントとして実装
- 親コンポーネントからのプロパティは`export let`で明示的に定義
- スタイルはscoped CSSを使用
- カスタムイベントはdispatchを使用

## 🧪 テスト要件

### テスト必須要素

以下の要素は必ずテストを作成してください：

1. **新しいAPI**: すべての新しいAPIエンドポイント
2. **認証機能**: 認証関連のすべての機能
3. **ビジネスロジック**: すべての重要なビジネスロジック
4. **バグ修正**: 修正したバグの再発防止テスト

### テストの種類

1. **ユニットテスト**: 個々の関数・メソッドのテスト
2. **統合テスト**: API全体やサービス層のテスト
3. **E2Eテスト**: フロントエンド・バックエンド間の連携テスト

### テスト実行

- コミット前に必ずローカルでテストを実行
- CI/CDパイプラインでもテストが自動的に実行される
- テスト失敗時は、テストを無効化せず根本的な修正を行う

## 🔒 セキュリティ要件

1. **認証・認可**: すべてのAPIエンドポイントで適切な認証・認可を実施
2. **入力検証**: すべてのユーザー入力を適切に検証
3. **SQLインジェクション対策**: クエリパラメータの使用を徹底
4. **XSS対策**: ユーザー入力の適切なエスケープ処理
5. **CSRF対策**: APIリクエストでの適切なCSRF対策
6. **ログ**: 機密情報をログに出力しない

## 🚀 CI/CD ワークフロー

### CI (継続的インテグレーション)

1. **コードチェック**: lint・format検証
2. **テスト**: 自動テスト実行
3. **ビルド**: コードのビルド

### CD (継続的デリバリー)

1. **ステージング環境へのデプロイ**: PRマージ後に自動デプロイ
2. **本番環境へのデプロイ**: 手動承認後に実行

## 📝 コミットメッセージ規約

良いコミットメッセージの例：

```
feat: テンプレート管理機能の実装

- テンプレートCRUD APIの実装
- マークダウン変換機能の追加
- テスト追加
```

コミットメッセージのプレフィックス：

- `feat`: 新機能
- `fix`: バグ修正
- `docs`: ドキュメントのみの変更
- `style`: コードの意味に影響しない変更（空白、フォーマットなど）
- `refactor`: リファクタリング
- `test`: テストの追加・修正
- `chore`: ビルドプロセスやツールの変更

## 🧰 環境構築

開発環境構築時に必要な手順は以下の通りです：

1. リポジトリのクローン
2. `.env.example`を`.env`にコピーして編集
3. lefthookのセットアップ（`./scripts/setup-lefthook.sh`）
4. Docker Composeで環境起動（`docker-compose up -d`）
5. データベースマイグレーション実行

## 🔄 コードレビュープロセス

### レビュー基準

1. **機能要件**: 仕様通りに実装されているか
2. **コード品質**: クリーンで理解しやすいコードか
3. **テスト**: 適切なテストが書かれているか
4. **セキュリティ**: セキュリティ上の問題がないか
5. **パフォーマンス**: パフォーマンス上の問題がないか

### レビュープロセス

1. PRの説明が明確か確認
2. コードの変更内容を確認
3. テスト結果を確認
4. 必要に応じてコメント
5. 承認または修正リクエスト

## 🐞 バグ報告方法

バグを発見した場合は、以下の情報を含めてIssueを作成してください：

1. バグの概要
2. 再現手順
3. 期待される動作
4. 実際の動作
5. スクリーンショットまたはログ（可能であれば）
6. 環境情報（ブラウザ、OS、デバイスなど）

## 📚 ドキュメント規約

### ドキュメント化必須要素

1. **API**: すべてのAPIエンドポイント
2. **データモデル**: すべてのデータモデルの定義と関係
3. **設定**: 環境変数などの設定方法
4. **デプロイ手順**: デプロイに必要な手順

### ドキュメントスタイル

- マークダウン形式で記述
- 見出しは適切に階層化
- コードブロックは言語指定
- スクリーンショットやダイアグラムを積極的に活用

## 🚦 問題解決の優先順位

1. **セキュリティ問題**: 最優先で対応
2. **データ整合性の問題**: ユーザーデータに影響するバグ
3. **機能不全**: 主要機能が動作しない問題
4. **使いにくさ**: UIやUXの問題
5. **パフォーマンス**: 速度や効率の問題
